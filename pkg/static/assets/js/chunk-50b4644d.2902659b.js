(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-50b4644d","chunk-15afde5f","chunk-1b6640d1","chunk-622de3e4"],{"037c":function(e,t,a){"use strict";a("8cc4")},"29e5":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("BasicLayout",{scopedSlots:e._u([{key:"wrapper",fn:function(){return[a("el-row",{staticClass:"mb10",attrs:{gutter:30}},[a("el-col",[a("el-card",{attrs:{shadow:"always"}},[a("el-button",{staticStyle:{"padding-left":"15px"},attrs:{type:"text"},on:{click:e.handleSendBatch}},[a("el-card",{staticClass:"box-card",staticStyle:{"background-color":"#9fe27e","align-items":"center"},attrs:{shadow:"always",align:"center"}},[a("i",{staticClass:"el-icon-s-promotion",staticStyle:{"font-size":"32px","margin-right":"10px"}}),a("span",{staticStyle:{"font-size":"24px"}},[e._v("发邮件")])])],1),a("el-button",{attrs:{type:"text"},on:{click:e.handleOpenSetting}},[a("el-card",{staticClass:"box-card",staticStyle:{"background-color":"#ced2da","align-items":"center"},attrs:{shadow:"always",align:"center"}},[a("i",{staticClass:"el-icon-setting",staticStyle:{"font-size":"32px","margin-right":"10px"}}),a("span",{staticStyle:{"font-size":"24px"}},[e._v("邮件发送配置")])])],1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:16}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("发送记录")])]),a("el-card",{staticClass:"box-card"},[a("el-form",{ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"模板"}},[a("el-select",{attrs:{placeholder:"按模板筛选",clearable:"",size:"small"},model:{value:e.queryParams.template_id,callback:function(t){e.$set(e.queryParams,"template_id",t)},expression:"queryParams.template_id"}},e._l(e.templates,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"客户邮箱"}},[a("el-input",{attrs:{placeholder:"请输入客户邮箱",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.customer_email,callback:function(t){e.$set(e.queryParams,"customer_email",t)},expression:"queryParams.customer_email"}})],1),a("el-form-item",{attrs:{label:"发送结果状态"}},[a("el-select",{attrs:{placeholder:"发送状态",clearable:"",size:"small"},model:{value:e.queryParams.status,callback:function(t){e.$set(e.queryParams,"status",t)},expression:"queryParams.status"}},e._l(e.statusOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),a("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.records,border:""}},[a("el-table-column",{attrs:{label:"模板",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.template.name)+" ")]}}])}),a("el-table-column",{attrs:{label:"客户",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.customer.email)+" ")]}}])}),a("el-table-column",{attrs:{label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[2===t.row.status?a("el-popover",{attrs:{placement:"top-start",title:"失败原因",width:"200",trigger:"hover",content:t.row.reason}},[a("el-tag",{attrs:{slot:"reference",type:"danger","disable-transitions":""},slot:"reference"},[e._v("失败")])],1):e._e(),1===t.row.status?a("el-tag",{attrs:{type:"success","disable-transitions":""}},[e._v("成功")]):e._e()]}}])}),a("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"created_at",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.parseTime(t.row.created_at)))])]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[2===t.row.status?a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-s-promotion"},on:{click:function(a){return e.handleReSend(t.row)}}},[e._v("重发")]):e._e(),a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageIndex,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageIndex",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1)],1)],1),a("el-col",{attrs:{span:8}},[e.current?a("el-card",{staticClass:"box-card",attrs:{"body-style":{padding:"0"}}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("当前任务")]),a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",plain:"",size:"small"},on:{click:e.handleCancelSend}},[e._v("结束当前任务")])],1),a("div",[a("p",[e._v("开始于: "+e._s(e.current.start_at))]),a("div",{staticClass:"tags"},[a("el-tag",{attrs:{size:"small"}},[e._v("总计("+e._s(e.current.total)+")")]),a("el-tag",{attrs:{size:"small",type:"success"}},[e._v("成功("+e._s(e.current.success)+")")]),a("el-tag",{attrs:{size:"small",type:"danger"}},[e._v("失败("+e._s(e.current.failure)+")")])],1),a("p",[e.current.error?a("el-tag",{attrs:{type:"danger"}},[e._v("任务失败: "+e._s(e.current.error))]):e._e()],1)]),a("el-progress",{attrs:{percentage:e.current.percentage}})],1):e._e()],1)],1),a("el-dialog",{attrs:{title:"邮件发送配置",visible:e.openSetting},on:{"update:visible":function(t){e.openSetting=t}}},[a("el-form",{ref:"setting",attrs:{model:e.cfg,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"邮件服务器",prop:"host"}},[a("el-input",{attrs:{placeholder:"请输入邮件服务器地址"},model:{value:e.cfg.host,callback:function(t){e.$set(e.cfg,"host",t)},expression:"cfg.host"}})],1),a("el-form-item",{attrs:{label:"端口",prop:"port"}},[a("el-input-number",{attrs:{"controls-position":"right",placeholder:"请输入监听端口"},model:{value:e.cfg.port,callback:function(t){e.$set(e.cfg,"port",t)},expression:"cfg.port"}})],1),a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.cfg.username,callback:function(t){e.$set(e.cfg,"username",t)},expression:"cfg.username"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{placeholder:"请输入密码","show-password":""},model:{value:e.cfg.password,callback:function(t){e.$set(e.cfg,"password",t)},expression:"cfg.password"}})],1),a("el-form-item",{attrs:{label:"发送间隔(ms)",prop:"interval"}},[a("el-input-number",{attrs:{step:100,"controls-position":"right",placeholder:"请输入发送间隔时间"},model:{value:e.cfg.interval,callback:function(t){e.$set(e.cfg,"interval",t)},expression:"cfg.interval"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),a("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1),a("el-dialog",{attrs:{title:"发送邮件",visible:e.openSending},on:{"update:visible":function(t){e.openSending=t}}},[a("el-form",{ref:"sending",attrs:{model:e.sendBatch,rules:e.sendBatchRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"使用模板",prop:"template_id"}},[a("el-select",{attrs:{placeholder:"请选择模板",clearable:"",size:"small"},model:{value:e.sendBatch.template_id,callback:function(t){e.$set(e.sendBatch,"template_id",t)},expression:"sendBatch.template_id"}},e._l(e.templates,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"客户选择模式"}},[a("el-switch",{attrs:{"active-value":!0,"active-text":"包含","inactive-value":!1,"inactive-text":"排除"},model:{value:e.sendBatch.include,callback:function(t){e.$set(e.sendBatch,"include",t)},expression:"sendBatch.include"}})],1),a("el-form-item",{attrs:{label:"选择客户",prop:"customers"}},[a("el-select",{attrs:{multiple:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入关键词","remote-method":e.findCustomers,loading:e.loading},model:{value:e.sendBatch.customer_ids,callback:function(t){e.$set(e.sendBatch,"customer_ids",t)},expression:"sendBatch.customer_ids"}},e._l(e.customers,(function(e){return a("el-option",{key:e.id,attrs:{label:e.email,value:e.id}})})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.doSend}},[e._v("开始发送")]),a("el-button",{on:{click:e.cancelSend}},[e._v("取 消")])],1)],1)]},proxy:!0}])})],1)},n=[],s=(a("7db0"),a("b775"));function i(e){return Object(s["a"])({url:"/api/v1/settings/"+e,method:"get"})}function o(e){return Object(s["a"])({url:"/api/v1/settings",method:"post",data:e})}function l(e){return Object(s["a"])({url:"/api/v1/records",method:"get",params:e})}function c(e){return Object(s["a"])({url:"/api/v1/records/"+e,method:"delete"})}var u=a("c621"),d=a("f6b0");function m(){return Object(s["a"])({url:"/api/v1/send-batches/current",method:"get"})}function p(e){return Object(s["a"])({url:"/api/v1/send-batches",method:"post",data:e})}function f(){return Object(s["a"])({url:"/api/v1/send-batches",method:"delete"})}var h={name:"SendManage",components:{},data:function(){return{queryParams:{pageIndex:1,pageSize:10,template_id:void 0,customer_email:void 0,status:void 0},loading:!1,total:0,records:[],templates:[],customers:[],openSetting:!1,cfg:{},statusOptions:[{label:"成功",value:1},{label:"失败",value:2}],rules:{host:[{required:!0,message:"邮件服务地址不能为空",trigger:"blur"}],port:[{required:!0,message:"邮件服务端口不能为空",trigger:"blur"}],username:[{required:!0,message:"邮件服务登录账号不能为空",trigger:"blur"}],password:[{required:!0,message:"邮件服务登录密码不能为空",trigger:"blur"}]},openSending:!1,sendBatch:{template_id:void 0,include:void 0,customer_ids:[]},sendBatchRules:{template_id:[{required:!0,message:"请选择模板",trigger:"blur"}]},current:void 0}},created:function(){this.getList(),this.loadTemplates(),this.loadCurrentTask()},methods:{getList:function(){var e=this;this.loading=!0,l(this.queryParams).then((function(t){e.records=t.data.list,e.total=t.data.pagination.total,e.loading=!1}))},loadTemplates:function(){var e=this;Object(u["d"])({pageSize:-1,lite:!0}).then((function(t){e.templates=t.data.list})).catch((function(t){e.msgError(t)}))},loadCurrentTask:function(){var e=this;m().then((function(t){var a=t.data;if(a){a.total>0?a.percentage=(a.success+a.failure)/a.total*100:a.percentage=0,a.error||setTimeout((function(){e.loadCurrentTask()}),1e3);var r=e.current&&e.current.success||0;a.success-r>5&&e.getList()}e.current=a})).catch((function(t){e.msgError(t)}))},loadSettings:function(){var e=this;return i("email_send_setting").then((function(t){var a=t.data&&t.data.value||{};return e.cfg=a,a})).catch((function(t){e.msgError(t)}))},findCustomers:function(e){var t=this;""!==e?(this.loading=!0,Object(d["e"])({keyword:e,pageSize:10}).then((function(e){t.customers=e.data.list,t.loading=!1})).catch((function(e){t.msgError(e)}))):this.customers=[]},handleQuery:function(){this.queryParams.pageIndex=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleOpenSetting:function(){var e=this;this.loadSettings().then((function(){e.openSetting=!0}))},submitForm:function(){var e=this;this.$refs["setting"].validate((function(t){t&&o({key:"email_send_setting",value:e.cfg}).then((function(t){e.openSetting=!1})).catch((function(t){e.msgError(t)}))}))},cancel:function(){this.openSetting=!1,this.reset()},reset:function(){this.cfg={host:void 0,port:void 0,username:void 0,password:void 0,interval:void 0},this.resetForm("setting")},handleSendBatch:function(){var e=this;this.loadSettings().then((function(t){t&&t.host?e.openSending=!0:e.$confirm("还未配置邮件服务器，是否现在开始配置?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.handleOpenSetting()})).catch((function(){}))}))},doSend:function(){var e=this;this.$refs["sending"].validate((function(t){t&&p(e.sendBatch).then((function(t){e.openSending=!1,e.loadCurrentTask()})).catch((function(t){e.msgError(t)}))}))},cancelSend:function(){this.openSending=!1,this.resetSend()},resetSend:function(){this.sendBatch={template_id:void 0,include:void 0,customer_ids:[]},this.resetForm("sending")},handleDelete:function(e){this.$confirm("操作不可恢复，是否确认删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=this;c(e.id).then((function(e){t.open=!1,t.getList()})).catch((function(e){t.msgError(e)}))})).catch((function(){}))},handleReSend:function(e){this.sendBatch={template_id:e.template_id,include:!0,customer_ids:[e.customer_id]};var t=this.customers||[];t.find((function(t){return t.id===e.customer_id}))||t.push({id:e.customer.id,email:e.customer.email}),this.handleSendBatch()},handleCancelSend:function(){var e=this;this.current.error?f().then((function(t){e.loadCurrentTask()})).catch((function(t){e.msgError(t)})):this.$confirm("当前发送任务还未完成，是否确定取消?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return f()})).then((function(t){e.loadCurrentTask()})).catch((function(t){e.msgError(t)}))}}},g=h,b=(a("037c"),a("2877")),v=Object(b["a"])(g,r,n,!1,null,"37259841",null);t["default"]=v.exports},"7db0":function(e,t,a){"use strict";var r=a("23e7"),n=a("b727").find,s=a("44d2"),i="find",o=!0;i in[]&&Array(1)[i]((function(){o=!1})),r({target:"Array",proto:!0,forced:o},{find:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),s(i)},"8cc4":function(e,t,a){},a8c4:function(e,t,a){var r={"./views/customer":"aedf","./views/customer/":"aedf","./views/customer/index":"aedf","./views/customer/index.vue":"aedf","./views/template":"da5e","./views/template/":"da5e","./views/template/index":"da5e","./views/template/index.vue":"da5e","./views/workbench":"29e5","./views/workbench/":"29e5","./views/workbench/index":"29e5","./views/workbench/index.vue":"29e5"};function n(e){var t=s(e);return a(t)}function s(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=s,e.exports=n,n.id="a8c4"},aedf:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("BasicLayout",{scopedSlots:e._u([{key:"wrapper",fn:function(){return[a("el-card",{staticClass:"box-card"},[a("el-form",{ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"68px"}},[a("el-form-item",{attrs:{label:"名称",prop:"email"}},[a("el-input",{attrs:{placeholder:"请输入客户名称",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.name_keyword,callback:function(t){e.$set(e.queryParams,"name_keyword",t)},expression:"queryParams.name_keyword"}})],1),a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{attrs:{placeholder:"请输入客户邮箱",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.keyword,callback:function(t){e.$set(e.queryParams,"keyword",t)},expression:"queryParams.keyword"}})],1),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-select",{attrs:{placeholder:"客户状态",clearable:"",size:"small"},model:{value:e.queryParams.status,callback:function(t){e.$set(e.queryParams,"status",t)},expression:"queryParams.status"}},e._l(e.statusOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),a("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),a("el-row",{staticClass:"mb8",attrs:{gutter:10}},[a("el-col",{attrs:{span:1.5}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:e.handleAdd}},[e._v("新增")])],1),a("el-col",{attrs:{span:1.5}},[a("el-button",{attrs:{type:"warning",icon:"el-icon-upload",size:"mini"},on:{click:function(t){e.openImport=!0}}},[e._v("导入")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.list,border:""}},[a("el-table-column",{attrs:{label:"名称",align:"center",prop:"name"}}),a("el-table-column",{attrs:{label:"邮箱",align:"center",prop:"email"}}),a("el-table-column",{attrs:{label:"状态",align:"center",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:2===t.row.status?"danger":"success","disable-transitions":""}},[e._v(e._s(2===t.row.status?"禁用":"启用"))])]}}])}),a("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"created_at",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.parseTime(t.row.created_at)))])]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handleUpdate(t.row)}}},[e._v("修改")]),a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageIndex,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageIndex",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),a("el-dialog",{attrs:{title:e.title,visible:e.open,width:"500px"},on:{"update:visible":function(t){e.open=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"客户名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入客户名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:"客户邮箱",prop:"email"}},[a("el-input",{attrs:{placeholder:"请输入客户邮箱"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-switch",{attrs:{"active-value":1,"active-text":"启用","inactive-value":2,"inactive-text":"禁用"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),a("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1),a("el-dialog",{attrs:{title:"批量导入客户信息",visible:e.openImport},on:{"update:visible":function(t){e.openImport=t}}},[a("el-upload",{staticClass:"upload-demo",attrs:{drag:"",accept:".xls,.xlsx",action:e.importUrl,"on-success":e.handleImportSuccess,"on-error":e.handleImportFailure}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),a("em",[e._v("点击上传")])]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传 Excel 文件，且不超过500kb")])]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.openImport=!1}}},[e._v("关 闭")])],1)],1)],1)]},proxy:!0}])})},n=[],s=(a("d81d"),a("f6b0")),i={name:"CustomerManage",data:function(){return{importUrl:s["d"],loading:!0,ids:[],single:!0,multiple:!0,total:0,list:[],title:"",open:!1,openImport:!1,statusOptions:[{label:"启用",value:1},{label:"禁用",value:2}],queryParams:{pageIndex:1,pageSize:10,name_keyword:void 0,keyword:void 0,status:void 0},form:{id:void 0,name:void 0,email:void 0,status:1},rules:{name:[{required:!0,message:"客户名称不能为空",trigger:"blur"}],email:[{required:!0,message:"客户邮箱不能为空",trigger:"blur"}]}}},created:function(){this.getList()},methods:{getList:function(){var e=this;this.loading=!0,Object(s["e"])(this.queryParams).then((function(t){e.list=t.data.list,e.total=t.data.pagination.total,e.loading=!1}))},statusFormat:function(e){return this.selectDictLabel(this.statusOptions,e.status)},cancel:function(){this.open=!1,this.reset()},reset:function(){this.form={id:void 0,name:void 0,email:void 0,status:1},this.resetForm("form")},handleQuery:function(){this.queryParams.pageIndex=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.postId})),this.single=1!==e.length,this.multiple=!e.length},handleAdd:function(){this.reset(),this.open=!0,this.title="添加客户信息"},handleUpdate:function(e){var t=this;this.reset(),Object(s["c"])(e.id).then((function(e){t.form=e.data,t.open=!0,t.title="修改客户信息"}))},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){t&&(void 0!==e.form.id?Object(s["f"])(e.form,e.form.id).then((function(t){e.open=!1,e.getList()})).catch((function(t){e.msgError(t)})):Object(s["a"])(e.form).then((function(t){e.open=!1,e.getList()})).catch((function(t){e.msgError(t)})))}))},handleDelete:function(e){this.$confirm("操作不可恢复，是否确认删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=this;Object(s["b"])(e.id).then((function(e){t.open=!1,t.getList()})).catch((function(e){t.msgError(e)}))})).catch((function(){}))},handleImportSuccess:function(e){this.msgInfo("导入成功"),this.getList()},handleImportFailure:function(e){this.msgError(e)}}},o=i,l=a("2877"),c=Object(l["a"])(o,r,n,!1,null,null,null);t["default"]=c.exports},b775:function(e,t,a){"use strict";a("d3b7");var r=a("bc3a"),n=a.n(r),s=a("5c96"),i=a("4360"),o=n.a.create({baseURL:"",timeout:1e4});o.interceptors.request.use((function(e){return i["a"].getters.token&&(e.headers["Content-Type"]="application/json"),e}),(function(e){return console.log(e),Promise.reject(e)})),o.interceptors.response.use((function(e){return 200===e.status?e:(Object(s["Message"])({showClose:!0,message:e.data.msg,type:"error",duration:5e3}),Promise.reject(e))}),(function(e){if("Network Error"!==e.message)return console.log("err: "+e),Object(s["Message"])({message:e.message,type:"error",duration:5e3}),Promise.reject(e);Object(s["Message"])({message:"服务器连接异常，请检查服务器！",type:"error",duration:5e3})})),t["a"]=o},c621:function(e,t,a){"use strict";a.d(t,"d",(function(){return n})),a.d(t,"c",(function(){return s})),a.d(t,"a",(function(){return i})),a.d(t,"e",(function(){return o})),a.d(t,"b",(function(){return l}));var r=a("b775");function n(e){return Object(r["a"])({url:"/api/v1/templates",method:"get",params:e})}function s(e){return Object(r["a"])({url:"/api/v1/templates/"+e,method:"get"})}function i(e){return Object(r["a"])({url:"/api/v1/templates",method:"post",data:e})}function o(e,t){return Object(r["a"])({url:"/api/v1/templates/"+t,method:"put",data:e})}function l(e){return Object(r["a"])({url:"/api/v1/templates/"+e,method:"delete"})}},da5e:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("BasicLayout",{scopedSlots:e._u([{key:"wrapper",fn:function(){return[a("el-card",{staticClass:"box-card"},[a("el-form",{ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"68px"}},[a("el-form-item",{attrs:{label:"名称",prop:"email"}},[a("el-input",{attrs:{placeholder:"请输入模板名称",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.name,callback:function(t){e.$set(e.queryParams,"name",t)},expression:"queryParams.name"}})],1),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-select",{attrs:{placeholder:"岗位状态",clearable:"",size:"small"},model:{value:e.queryParams.status,callback:function(t){e.$set(e.queryParams,"status",t)},expression:"queryParams.status"}},e._l(e.statusOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),a("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),a("el-row",{staticClass:"mb8",attrs:{gutter:10}},[a("el-col",{attrs:{span:1.5}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:e.handleAdd}},[e._v("新增")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.list,border:""}},[a("el-table-column",{attrs:{label:"名称",align:"center",prop:"name"}}),a("el-table-column",{attrs:{label:"主题"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.subject.split("_::_"),(function(t,r){return a("div",{key:r},[e._v(e._s(r)+": "+e._s(t))])}))}}])}),a("el-table-column",{attrs:{label:"发件人邮箱",align:"center",prop:"from"}}),a("el-table-column",{attrs:{label:"发件人名称",align:"center",prop:"from_name"}}),a("el-table-column",{attrs:{label:"回复邮箱",align:"center",prop:"reply_to"}}),a("el-table-column",{attrs:{label:"状态",align:"center",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:2===t.row.status?"danger":"success","disable-transitions":""}},[e._v(e._s(2===t.row.status?"禁用":"启用"))])]}}])}),a("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"created_at",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.parseTime(t.row.created_at)))])]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handlePreview(t.row)}}},[e._v("预览")]),a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handleUpdate(t.row)}}},[e._v("修改")]),a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageIndex,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageIndex",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),a("el-dialog",{attrs:{title:e.title,visible:e.open},on:{"update:visible":function(t){e.open=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[a("el-row",{attrs:{gutter:5}},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"模板名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入模板名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1),a("el-row",{attrs:{gutter:5}},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"发件人邮箱",prop:"from"}},[a("el-input",{attrs:{placeholder:"请输入发件人邮箱"},model:{value:e.form.from,callback:function(t){e.$set(e.form,"from",t)},expression:"form.from"}})],1)],1),a("el-col",{attrs:{span:10,offset:2}},[a("el-form-item",{attrs:{label:"发件人名称",prop:"from_name"}},[a("el-input",{attrs:{placeholder:"请输入发件人名称"},model:{value:e.form.from_name,callback:function(t){e.$set(e.form,"from_name",t)},expression:"form.from_name"}})],1)],1)],1),a("el-row",{attrs:{gutter:5}},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"回复邮箱",prop:"reply_to"}},[a("el-input",{attrs:{placeholder:"请输入回复邮箱"},model:{value:e.form.reply_to,callback:function(t){e.$set(e.form,"reply_to",t)},expression:"form.reply_to"}})],1)],1),a("el-col",{attrs:{span:10,offset:2}},[a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-switch",{attrs:{"active-value":1,"active-text":"启用","inactive-value":2,"inactive-text":"禁用"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}})],1)],1)],1),e._l(e.form.subjects,(function(t,r){return a("el-row",{key:r,attrs:{gutter:10}},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"主题"+r,prop:"subjects."+r,rules:{required:!0,message:"主题不能为空",trigger:"blur"}}},[a("el-input",{attrs:{placeholder:"请输入邮件主题"},model:{value:e.form.subjects[r],callback:function(t){e.$set(e.form.subjects,r,t)},expression:"form.subjects[index]"}})],1)],1),e.form.subjects.length>1?a("el-col",{attrs:{span:2}},[a("el-button",{staticStyle:{"margin-top":"6px"},attrs:{type:"danger",icon:"el-icon-delete",size:"mini",circle:""},on:{click:function(t){return t.preventDefault(),e.removeSubject(r)}}})],1):e._e()],1)})),a("el-row",[a("el-button",{staticStyle:{"margin-left":"100px","margin-bottom":"15px"},on:{click:e.addSubject}},[e._v("新增主题")])],1),a("el-row",{attrs:{gutter:5}},[a("el-col",[a("el-form-item",{attrs:{label:"邮件正文",prop:"content"}},[a("quill-editor",{staticClass:"editor",staticStyle:{height:"280px","margin-bottom":"45px"},attrs:{options:e.editorOption},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1)],1)],1)],2),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),a("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1),a("el-dialog",{attrs:{title:"预览邮件正文",visible:e.preview},on:{"update:visible":function(t){e.preview=t}}},[a("div",{staticClass:"ql-editor",domProps:{innerHTML:e._s(e.previewContent)}})])],1)]},proxy:!0}])})},n=[],s=(a("d81d"),a("ac1f"),a("1276"),a("a15b"),a("a434"),a("c621")),i=a("9339"),o=a.n(i),l=(a("a753"),a("8096"),a("14e1"),a("2a19")),c=a("f318"),u=a.n(c),d=a("953d");o.a.register("modules/imageDrop",l["a"]),o.a.register("modules/imageResize",u.a);var m={name:"TemplateManage",components:{quillEditor:d["quillEditor"]},data:function(){return{editorOption:{modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{font:[]}],[{color:[]},{background:[]}],[{align:[]}],["clean"],["link","image","emoji"]],history:{delay:1e3,maxStack:50,userOnly:!1},imageDrop:!0,imageResize:{displayStyles:{backgroundColor:"black",border:"none",color:"white"},modules:["Resize","DisplaySize","Toolbar"]}},placeholder:"输入内容........"},loading:!0,ids:[],single:!0,multiple:!0,total:0,list:[],title:"",open:!1,preview:!1,previewContent:void 0,statusOptions:[{label:"启用",value:1},{label:"禁用",value:2}],queryParams:{pageIndex:1,pageSize:10,name:void 0,status:void 0},form:{subjects:[""]},rules:{name:[{required:!0,message:"模板名称不能为空",trigger:"blur"}],from:[{required:!0,message:"发件人不能为空",trigger:"blur"}],content:[{required:!0,message:"邮件正文不能为空",trigger:"blur"}]}}},created:function(){this.getList()},methods:{getList:function(){var e=this;this.loading=!0,Object(s["d"])(this.queryParams).then((function(t){e.list=t.data.list,e.total=t.data.pagination.total,e.loading=!1})).catch((function(t){e.msgError(t)}))},statusFormat:function(e){return this.selectDictLabel(this.statusOptions,e.status)},cancel:function(){this.open=!1,this.reset()},reset:function(){this.form={id:void 0,name:void 0,subject:void 0,from:void 0,from_name:void 0,reply_to:void 0,content:void 0,status:1,subjects:[""]},this.resetForm("form")},handleQuery:function(){this.queryParams.pageIndex=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.postId})),this.single=1!==e.length,this.multiple=!e.length},handleAdd:function(){this.reset(),this.open=!0,this.title="新建邮件模板"},handlePreview:function(e){this.previewContent=e.content,this.preview=!0},handleUpdate:function(e){var t=this;this.reset(),Object(s["c"])(e.id).then((function(e){var a=e.data;a.subjects=a.subject.split("_::_"),delete a.subject,t.form=a,t.open=!0,t.title="修改邮件模板"})).catch((function(e){t.msgError(e)}))},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){if(t){var a=Object.assign(e.form,{});a.subject=a.subjects.join("_::_"),delete a.subjects,void 0!==a.id?Object(s["e"])(a,a.id).then((function(t){e.open=!1,e.getList()})).catch((function(t){e.msgError(t)})):Object(s["a"])(a).then((function(t){e.open=!1,e.getList()})).catch((function(t){e.msgError(t)}))}}))},handleDelete:function(e){var t=this;this.$confirm("删除模板会连带删除发送记录，操作不可恢复，是否确认删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["b"])(e.id).then((function(e){t.open=!1,t.getList()})).catch((function(e){t.msgError(e)}))})).catch((function(){}))},addSubject:function(){this.form.subjects.push("")},removeSubject:function(e){this.form.subjects.splice(e,1)}}},p=m,f=a("2877"),h=Object(f["a"])(p,r,n,!1,null,null,null);t["default"]=h.exports},f6b0:function(e,t,a){"use strict";a.d(t,"e",(function(){return n})),a.d(t,"c",(function(){return s})),a.d(t,"a",(function(){return i})),a.d(t,"f",(function(){return o})),a.d(t,"b",(function(){return l})),a.d(t,"d",(function(){return c}));var r=a("b775");function n(e){return Object(r["a"])({url:"/api/v1/customers",method:"get",params:e})}function s(e){return Object(r["a"])({url:"/api/v1/customers/"+e,method:"get"})}function i(e){return Object(r["a"])({url:"/api/v1/customers",method:"post",data:e})}function o(e,t){return Object(r["a"])({url:"/api/v1/customers/"+t,method:"put",data:e})}function l(e){return Object(r["a"])({url:"/api/v1/customers/"+e,method:"delete"})}var c="/api/v1/customers/import"}}]);